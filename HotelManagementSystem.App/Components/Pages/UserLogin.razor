@page "/login"
@using HotelManagementSystem.Domain.Features.User
@using HotelManagementSystem.Shared
@rendermode RenderMode.InteractiveServer
@layout EmptyLayout
@inject NavigationManager Navigation
@inject ISnackbar Snackbar
@inject Domain.Features.User.UserServices _userService

<MudContainer MaxWidth="MaxWidth.Small">
    <MudCard>
        <MudCardContent>
            <MudForm Model="loginModel">
                <MudText Typo="Typo.h5" Class="mb-4">Login</MudText>

                <MudTextField Label="Email" @bind-Value="loginModel.Email" Required="true" RequiredError="Email is required" />

                <MudTextField Label="Password" @bind-Value="loginModel.Password" Required="true" RequiredError="Password is required" Type="password" />

                <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Login">
                    Login
                </MudButton>
            </MudForm>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {

    private LoginModel loginModel = new();

    private async Task<Result<UserModel>?> Login()
    {
        var model = new Result<UserModel>();

        model = await _userService.Login(loginModel.Email, loginModel.Password);

        if (model!.IsSuccess)
        {
            Snackbar.Add("Login successful!", Severity.Success);
            Navigation.NavigateTo("/");

            model = new Result<UserModel>
                {
                    IsSuccess = true,
                    Data = new UserModel
                    {
                        UserId = model.Data!.UserId,
                        Username = model.Data.Username,
                        Email = model.Data.Email,
                        PasswordHash = model.Data.PasswordHash,
                        Role = model.Data.Role,
                        CreatedAt = model.Data.CreatedAt
                    }
                };
        }
        else
        {
            Snackbar.Add("Login failed!", Severity.Error);
            Navigation.NavigateTo("/login");
        }

        return model;
    }

    private class LoginModel
    {
        public string Email { get; set; } = "";
        public string Password { get; set; } = "";
    }
}